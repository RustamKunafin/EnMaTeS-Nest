# ПРИМЕР КОМАНДЫ ДЛЯ ЗАПУСКА:
# python 022112_Toolkit/Connectome_Weaver/weaverSG/main.py batch-modify --recipe 022112_Toolkit/Connectome_Weaver/recipes/recipe_schema_v2_muid_alias_lid.yaml --file path/to/MyGraph.md

# ВНИМАНИЕ: Этот рецепт проводит глобальную миграцию схемы. Применять ПОСЛЕ recipe_datafix_v2.
description: "Schema Migration v2: Introduce 'alias', canonical UUIDs for MUIDs, and ensure all 'link' relations have an 'LID'."
steps:
  # --- Шаг 1: Добавить поле 'alias' ко всем узлам ---
  - operation: add_node_field
    params:
      field_name: "alias"
      default_value: ""

  # --- Шаг 2: Скопировать старые текстовые MUID в 'alias' ---
  - operation: copy_field
    params:
      source_field: "MUID"
      target_field: "alias"
      where:
        field: "MUID"
        condition: "is_not_uuid"

  # --- Шаг 3: Заменить старые MUID на новые каноничные UUID ---
  - operation: set_field_from_generated_uuid
    params:
      target_field: "MUID"
      where:
        field: "MUID"
        condition: "is_not_uuid"
        
  # --- Шаг 4: Обеспечить наличие LID у всех существующих связей 'link' ---
  # Это гарантирует, что даже старые связи, которые уже были в графе до введения LID, получат свой ID.
  - operation: add_lid_to_links
    params: {}