# Connectome Weaver (`weaverSG`)

### 1. Краткое описание

`weaverSG` — это транзакционный CLI-инструмент для аудита, миграции и безопасного редактирования Семантических Графов (SG) в экосистеме EnMaTeS.

### 2. Предназначение и роль в экосистеме

В парадигме метасистемы **Membra**, Семантический Граф (SG) является **артефактом** — статичной "картой" или снимком **Коннектома** (полной структуры связей). `Connectome Weaver` и его ядро `weaverSG` — это **система**, которая выступает в роли "Картографа", обеспечивая целостность и эволюцию этой карты.

Ключевые задачи, которые решает `weaverSG`:

* **Целостность данных:** Инструмент позволяет проводить валидацию графа, находить "висячие" связи и другие аномалии.
* **Безопасные изменения:** Все модификации выполняются через транзакционный механизм с ведением лога (`LSG`) и автоматическим созданием бэкапов. Это гарантирует, что граф никогда не будет поврежден в результате сбоя.
* **Прослеживаемость (Traceability):** Каждое изменение в SG фиксируется в связанном с ним Log Semantic Graph (`LSG`). Это позволяет отследить полную историю каждого узла и каждой связи.
* **Эволюция структуры:** `weaverSG` предоставляет механизмы для безопасной миграции схемы графа, например, для "продвижения" легковесных связей (`link`) до системных связок (`bind`).

### 3. Установка

1.  Убедитесь, что у вас установлен Python 3.
2.  Установите необходимые зависимости:
    ```bash
    pip install pyyaml
    ```

### 4. Использование

Все команды выполняются из корневой папки проекта.

#### Пакетное изменение графа

Выполняет серию операций, описанных в файле-рецепте.

```bash
python weaverSG/main.py batch-modify --recipe path/to/recipe.yaml --file path/to/MyGraph.md
```

* `--recipe`: Путь к YAML-файлу с инструкциями.
* `--file`: Путь к целевому файлу Семантического Графа.
* `--no-backup` (опционально): Отключает автоматическое создание бэкапа.

#### Продвижение связи

Превращает легковую связь `link` (идентифицируемую по `LID`) в системную `bind`, присваивая ей `MUID`.

```bash
python weaverSG/main.py promote-relation --lid <LID_связи> --file path/to/MyGraph.md
```

* `--lid`: `LID` связи, которую необходимо "продвинуть".
* `--file`: Путь к файлу Семантического Графа, содержащему связь.

### 5. Пример использования: Первичная миграция графа

Для первоначальной настройки и исправления существующего Семантического Графа мы используем два рецепта в строгой последовательности.

1.  **Исправление данных (`recipe_datafix_v1_dangling_nodes.yaml`):**
    Этот рецепт исправляет логические ошибки в данных, такие как "висячие" связи. Его необходимо запустить **первым**, так как он оперирует старыми, текстовыми идентификаторами.
    ```bash
    python weaverSG/main.py batch-modify --recipe recipes/recipe_datafix_v1_dangling_nodes.yaml --file path/to/MyGraph.md
    ```

2.  **Миграция схемы (`recipe_schema_v1_muid_alias.yaml`):**
    После исправления данных, этот рецепт проводит глобальную миграцию схемы: вводит поле `alias` и заменяет все текстовые `MUID` на каноничные `UUID`.
    ```bash
    python weaverSG/main.py batch-modify --recipe recipes/recipe_schema_v1_muid_alias.yaml --file path/to/MyGraph.md
    ```

### 6. Лицензия

Membra Open Development License (MODL) v1.0
Copyright (c) Rustam Kunafin 2025. All rights reserved.

Licensed under Membra Open Development License (MODL) v1.0. See LICENSE or https://cyberries.org/04_Resources/0440_Agreements/MODL.
Core artifacts are under MODL; derivatives may use other licenses with attribution.
