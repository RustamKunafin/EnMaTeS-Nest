# Connectome Weaver (`weaverSG`)

### 1. Краткое описание

`weaverSG` — это транзакционный CLI-инструмент для аудита, миграции и безопасного редактирования Семантических Графов (SG) в экосистеме EnMaTeS.

### 2. Предназначение и роль в экосистеме

В парадигме метасистемы **Membra**, Семантический Граф (SG) является **артефактом** — статичной "картой" или снимком **Коннектома** (полной структуры связей). `Connectome Weaver` и его ядро `weaverSG` — это **система**, которая выступает в роли "Картографа", обеспечивая целостность и эволюцию этой карты.

Ключевые задачи, которые решает `weaverSG`:

* **Целостность данных:** Инструмент позволяет проводить полный аудит графа, находить "висячие" связи, дубликаты узлов и связей, а также другие аномалии.
* **Безопасные изменения:** Все модификации выполняются через транзакционный механизм с ведением лога (`LSG`) и автоматическим созданием бэкапов. Это гарантирует, что граф никогда не будет поврежден в результате сбоя.
* **Прослеживаемость (Traceability):** Каждое изменение в SG фиксируется в связанном с ним Log Semantic Graph (`LSG`). Это позволяет отследить полную историю каждого узла и каждой связи.
* **Эволюция структуры:** `weaverSG` предоставляет механизмы для безопасной миграции схемы графа, например, для "продвижения" легковесных связей (`link`) до системных связок (`bind`).

### 3. Установка

1.  Убедитесь, что у вас установлен Python 3.
2.  Установите необходимые зависимости:
    ```bash
    pip install pyyaml
    ```

### 4. Использование

Все команды выполняются из корневой папки проекта.

#### Валидация графа (Диагностика)

Выполняет полный аудит графа, выводит отчет в консоль и записывает найденные проблемы в блок `validation_issues` в самом файле графа.

```bash
python weaverSG/main.py validate --file path/to/MyGraph.md
```

#### Пакетное изменение графа (Лечение)

Выполняет серию операций, описанных в файле-рецепте.

```bash
python weaverSG/main.py batch-modify --recipe path/to/recipe.yaml --file path/to/MyGraph.md
```

* `--recipe`: Путь к YAML-файлу с инструкциями.
* `--file`: Путь к целевому файлу Семантического Графа.
* `--no-backup` (опционально): Отключает автоматическое создание бэкапа.

#### Продвижение связи

Превращает легковую связь `link` (идентифицируемую по `LID`) в системную `bind`, присваивая ей `MUID`.

```bash
python weaverSG/main.py promote-relation --lid <LID_связи> --file path/to/MyGraph.md
```

### 5. Пример рабочего процесса: Первичная миграция графа

Для первоначальной настройки и исправления существующего Семантического Графа мы используем следующий рабочий процесс: **"Диагностика -> Исправление -> Миграция"**.

1.  **Диагностика (`validate`):**
    Сначала запускаем аудит на исходном, нетронутом графе, чтобы получить полный список проблем.
    ```bash
    python 022112_Toolkit/Connectome_Weaver/weaverSG/main.py validate --file path/to/MyOriginalGraph.md
    ```

2.  **Исправление данных (`recipe_datafix...`):**
    После анализа отчета о валидации, мы запускаем рецепт, который исправляет логические ошибки в данных (например, "висячие" связи).
    ```bash
    python 022112_Toolkit/Connectome_Weaver/weaverSG/main.py batch-modify --recipe recipes/recipe_datafix_v2.yaml --file path/to/MyOriginalGraph.md
    ```

3.  **Миграция схемы (`recipe_schema...`):**
    После исправления данных, этот рецепт проводит глобальную миграцию схемы: вводит поле `alias`, заменяет все текстовые `MUID` на каноничные `UUID` и присваивает `LID` всем старым связям.
    ```bash
    python 022112_Toolkit/Connectome_Weaver/weaverSG/main.py batch-modify --recipe recipes/recipe_schema_v2_muid_alias_lid.yaml --file path/to/MyOriginalGraph.md
    ```

### 6. Лицензия

Membra Open Development License (MODL) v1.0
Copyright (c) Rustam Kunafin 2025. All rights reserved.

Licensed under Membra Open Development License (MODL) v1.0. See LICENSE or https://cyberries.org/04_Resources/0440_Agreements/MODL.
Core artifacts are under MODL; derivatives may use other licenses with attribution.
